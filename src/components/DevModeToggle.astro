---
/**
 * Dev Mode Toggle - similar to theme toggle
 * Shows/hides PageStatus components across the site
 */
---

<starlight-dev-mode-toggle>
  <button
    type="button"
    id="dev-mode-toggle"
    aria-label="Toggle dev mode"
    title="Toggle editorial info (dev mode)"
  >
    <svg class="icon-off" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <polyline points="10 9 9 9 8 9"></polyline>
    </svg>
    <svg class="icon-on" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <polyline points="10 9 9 9 8 9"></polyline>
      <circle cx="17" cy="17" r="5" fill="currentColor" stroke="none"></circle>
      <path d="M15 17l1.5 1.5 3-3" stroke="white" stroke-width="2" fill="none"></path>
    </svg>
  </button>
</starlight-dev-mode-toggle>

<style>
  starlight-dev-mode-toggle {
    display: contents;
  }

  button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    padding: 0.25rem;
    border: none;
    border-radius: 0.5rem;
    background: transparent;
    color: var(--sl-color-gray-3);
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
  }

  button:hover {
    background: var(--sl-color-gray-6);
    color: var(--sl-color-gray-1);
  }

  .icon-off,
  .icon-on {
    display: none;
  }

  :global(:root:not(.page-status-dev-mode)) .icon-off {
    display: block;
  }

  :global(:root.page-status-dev-mode) .icon-on {
    display: block;
    color: #8b5cf6;
  }

  :global(:root.page-status-dev-mode) button {
    background: rgba(139, 92, 246, 0.15);
  }
</style>

<!-- Inline script runs on every page load to set class before paint -->
<script is:inline>
  (function() {
    if (localStorage.getItem('pageStatusDevMode') === 'true') {
      document.documentElement.classList.add('page-status-dev-mode');
    }
  })();
</script>

<script>
  class DevModeToggle extends HTMLElement {
    button: HTMLButtonElement | null = null;

    constructor() {
      super();
      this.button = this.querySelector('button');
    }

    connectedCallback() {
      this.button?.addEventListener('click', () => {
        const current = document.documentElement.classList.contains('page-status-dev-mode');
        if (current) {
          document.documentElement.classList.remove('page-status-dev-mode');
          localStorage.removeItem('pageStatusDevMode');
        } else {
          document.documentElement.classList.add('page-status-dev-mode');
          localStorage.setItem('pageStatusDevMode', 'true');
        }
      });
    }
  }

  customElements.define('starlight-dev-mode-toggle', DevModeToggle);
</script>
